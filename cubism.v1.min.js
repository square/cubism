(function(e){function r(e){return e}function i(){}function u(e){return Math.floor(e/1e3)}function a(e){var t=e.indexOf("|"),n=e.substring(0,t),r=n.lastIndexOf(","),i=n.lastIndexOf(",",r-1),s=n.lastIndexOf(",",i-1),o=n.substring(s+1,i)*1e3,u=n.substring(r+1)*1e3;return e.substring(t+1).split(",").slice(1).map(function(e){return+e})}function f(e){if(!(e instanceof i))throw new Error("invalid context");this.context=e}function h(e,t){return function(n,r,i,s){e(new Date(+n+t),new Date(+r+t),i,s)}}function p(e,t){f.call(this,e),t=+t;var n=t+"";this.valueOf=function(){return t},this.toString=function(){return n}}function v(e,t){function n(t,n){if(n instanceof f){if(t.context!==n.context)throw new Error("mismatch context")}else n=new p(t.context,n);f.call(this,t.context),this.left=t,this.right=n,this.toString=function(){return t+" "+e+" "+n}}var r=n.prototype=Object.create(f.prototype);return r.valueAt=function(e){return t(this.left.valueAt(e),this.right.valueAt(e))},r.shift=function(e){return new n(this.left.shift(e),this.right.shift(e))},r.on=function(e,t){return arguments.length<2?this.left.on(e):(this.left.on(e,t),this.right.on(e,t),this)},function(e){return new n(this,e)}}function y(e){return e&16777214}function b(e){return(e+1&16777214)-1}var t=e.cubism={version:"1.1.0"},n=0;t.option=function(e,n){var r=t.options(e);return r.length?r[0]:n},t.options=function(e,t){var n=location.search.substring(1).split("&"),r=[],i=-1,s=n.length,o;while(++i<s)(o=n[i].split("="))[0]==e&&r.push(decodeURIComponent(o[1]));return r.length||arguments.length<2?r:t},t.context=function(){function v(){var n=Date.now();return o=new Date(Math.floor((n-f-l)/t)*t),s=new Date(o-r*t),a=new Date(Math.floor((n-f)/t)*t),u=new Date(a-r*t),h.domain([s,o]),e}var e=new i,t=1e4,r=1440,s,o,u,a,f=5e3,l=5e3,c=d3.dispatch("prepare","beforechange","change","focus"),h=e.scale=d3.time.scale().range([0,r]),p,d;return e.start=function(){p&&clearTimeout(p);var n=+a+f-Date.now();return n<l&&(n+=t),p=setTimeout(function i(){a=new Date(Math.floor((Date.now()-f)/t)*t),u=new Date(a-r*t),c.prepare.call(e,u,a),setTimeout(function(){h.domain([s=u,o=a]),c.beforechange.call(e,u,a),c.change.call(e,u,a),c.focus.call(e,d)},l),p=setTimeout(i,t)},n),e},e.stop=function(){return p=clearTimeout(p),e},p=setTimeout(e.start,10),e.step=function(e){return arguments.length?(t=+e,v()):t},e.size=function(e){return arguments.length?(h.range([0,r=+e]),v()):r},e.serverDelay=function(e){return arguments.length?(f=+e,v()):f},e.clientDelay=function(e){return arguments.length?(l=+e,v()):l},e.focus=function(t){return c.focus.call(e,d=t),e},e.on=function(t,n){return arguments.length<2?c.on(t):(c.on(t,n),n!=null&&(/^prepare(\.|$)/.test(t)&&n.call(e,u,a),/^beforechange(\.|$)/.test(t)&&n.call(e,s,o),/^change(\.|$)/.test(t)&&n.call(e,s,o),/^focus(\.|$)/.test(t)&&n.call(e,d)),e)},d3.select(window).on("keydown.context-"+ ++n,function(){switch(!d3.event.metaKey&&d3.event.keyCode){case 37:d==null&&(d=r-1),d>0&&e.focus(--d);break;case 39:d==null&&(d=r-2),d<r-1&&e.focus(++d);break;default:return}d3.event.preventDefault()}),v()};var s=i.prototype;s.constant=function(e){return new p(this,+e)},s.cube=function(e){arguments.length||(e="");var t={},n=this;return t.metric=function(t){return n.metric(function(n,r,i,s){d3.json(e+"/1.0/metric"+"?expression="+encodeURIComponent(t)+"&start="+o(n)+"&stop="+o(r)+"&step="+i,function(e){if(!e)return s(new Error("unable to load data"));s(null,e.map(function(e){return e.value}))})},t+="")},t.toString=function(){return e},t};var o=d3.time.format.iso;s.graphite=function(e){function r(e){var r=Math.round(n.step()/1e3);return r===10?this:(r=r%3600?r%60?r+"sec":r/60+"min":r/3600+"hour",t.metric("summarize("+this+",'"+r+"','"+e+"')"))}arguments.length||(e="");var t={},n=this;return t.metric=function(t){var i=n.metric(function(n,r,i,s){d3.text(e+"/render?format=raw"+"&target="+encodeURIComponent("alias("+t+",'')")+"&from="+u(n-2*i)+"&until="+u(r-1e3),function(e){if(!e)return s(new Error("unable to load data"));s(null,a(e))})},t+="");return i.summarize=r,i},t.find=function(t,n){d3.json(e+"/metrics/find?format=completer"+"&query="+encodeURIComponent(t),function(e){if(!e)return n(new Error("unable to find metrics"));n(null,e.metrics.map(function(e){return e.path}))})},t.toString=function(){return e},t};var l=f.prototype;l.valueAt=function(){return NaN},l.alias=function(e){return this.toString=function(){return e},this},l.extent=function(){var e=0,t=this.context.size(),n,r=Infinity,i=-Infinity;while(++e<t)n=this.valueAt(e),n<r&&(r=n),n>i&&(i=n);return[r,i]},l.on=function(e,t){return arguments.length<2?null:this},l.shift=function(){return this},l.on=function(){return arguments.length<2?null:this},s.metric=function(e,t){function g(t,n){var r=Math.min(l,Math.round((t-o)/a));if(!r||m)return;m=!0,r=Math.min(l,r+c);var s=new Date(n-r*a);e(s,n,a,function(e,t){m=!1;if(e)return console.warn(e);var r=isFinite(o)?Math.round((s-o)/a):0;for(var u=0,f=t.length;u<f;++u)p[u+r]=t[u];d.change.call(i,o,n)})}function y(e,t){isFinite(o)||(o=e),p.splice(0,Math.max(0,Math.min(l,Math.round((e-o)/a)))),o=e,u=t}var r=this,i=new f(r),s=".metric-"+ ++n,o=-Infinity,u,a=r.step(),l=r.size(),p=[],d=d3.dispatch("change"),v=0,m;return i.valueAt=function(e){return p[e]},i.shift=function(t){return r.metric(h(e,+t))},i.on=function(e,t){return arguments.length?(t==null?d.on(e)!=null&&--v==0&&r.on("prepare"+s,null).on("beforechange"+s,null):d.on(e)==null&&++v==1&&r.on("prepare"+s,g).on("beforechange"+s,y),d.on(e,t),t!=null&&/^change(\.|$)/.test(e)&&t.call(r,o,u),i):d.on(e)},arguments.length>1&&(i.toString=function(){return t}),i};var c=6,d=p.prototype=Object.create(f.prototype);d.valueAt=function(){return+this},d.extent=function(){return[+this,+this]},l.add=v("+",function(e,t){return e+t}),l.subtract=v("-",function(e,t){return e-t}),l.multiply=v("*",function(e,t){return e*t}),l.divide=v("/",function(e,t){return e/t}),s.horizon=function(){function d(d){d.on("mousemove.horizon",function(){e.focus(d3.mouse(this)[0])}).on("mouseout.horizon",function(){e.focus(null)}),d.append("canvas").attr("width",s).attr("height",o),d.append("span").attr("class","title").text(l),d.append("span").attr("class","value"),d.each(function(l,d){function k(n,r){S.save();var a=g.extent();C=a.every(isFinite),b!=null&&(a=b);var f=0,l=Math.max(-a[0],a[1]);if(this===e){if(l==T){f=s-c;var h=(n-w)/E;if(h<s){var p=i.getContext("2d");p.clearRect(0,0,s,o),p.drawImage(S.canvas,h,0,s-h,o,0,0,s-h,o),S.clearRect(0,0,s,o),S.drawImage(p.canvas,0,0)}}w=n}u.domain([0,T=l]),S.clearRect(f,0,s-f,o);var d;for(var v=0;v<N;++v){S.fillStyle=y[N+v];var m=(v-N+1)*o;u.range([N*o+m,m]),m=u(0);for(var x=f,k=s,L;x<k;++x){L=g.valueAt(x);if(L<=0){d=!0;continue}S.fillRect(x,L=u(L),1,m-L)}}if(d){t==="offset"&&(S.translate(0,o),S.scale(1,-1));for(var v=0;v<N;++v){S.fillStyle=y[N-1-v];var m=(v-N+1)*o;u.range([N*o+m,m]),m=u(0);for(var x=f,k=s,L;x<k;++x){L=g.valueAt(x);if(L>=0)continue;S.fillRect(x,u(-L),1,m-u(-L))}}}S.restore()}function L(e){e==null&&(e=s-1);var t=g.valueAt(Math.round(e));x.datum(t).text(isNaN(t)?null:h)}var v=this,m=++n,g=typeof a=="function"?a.call(v,l,d):a,y=typeof p=="function"?p.call(v,l,d):p,b=typeof f=="function"?f.call(v,l,d):f,w=-Infinity,E=e.step(),S=d3.select(v).select("canvas"),x=d3.select(v).select(".value"),T,N=y.length>>1,C;S.datum({id:m,metric:g}),S=S.node().getContext("2d"),e.on("change.horizon-"+m,k),e.on("focus.horizon-"+m,L),g.on("change.horizon-"+m,function(e,t){k(e,t),L(),C&&g.on("change.horizon-"+m,r)})})}var e=this,t="offset",i=document.createElement("canvas"),s=i.width=e.size(),o=i.height=30,u=d3.scale.linear().interpolate(d3.interpolateRound),a=r,f=null,l=r,h=d3.format(".2s"),p=["#08519c","#3182bd","#6baed6","#bdd7e7","#bae4b3","#74c476","#31a354","#006d2c"];return d.remove=function(t){function n(t){t.metric.on("change.horizon-"+t.id,null),e.on("change.horizon-"+t.id,null),e.on("focus.horizon-"+t.id,null)}t.on("mousemove.horizon",null).on("mouseout.horizon",null),t.selectAll("canvas").each(n).remove(),t.selectAll(".title,.value").remove()},d.mode=function(e){return arguments.length?(t=e+"",d):t},d.height=function(e){return arguments.length?(i.height=o=+e,d):o},d.metric=function(e){return arguments.length?(a=e,d):a},d.scale=function(e){return arguments.length?(u=e,d):u},d.extent=function(e){return arguments.length?(f=e,d):f},d.title=function(e){return arguments.length?(l=e,d):l},d.format=function(e){return arguments.length?(h=e,d):h},d.colors=function(e){return arguments.length?(p=e,d):p},d},s.comparison=function(){function d(d){d.on("mousemove.comparison",function(){e.focus(d3.mouse(this)[0])}).on("mouseout.comparison",function(){e.focus(null)}),d.append("canvas").attr("width",t).attr("height",i),d.append("span").attr("class","title").text(f),d.append("span").attr("class","value primary"),d.append("span").attr("class","value change"),d.each(function(f,d){function k(n,r){x.save(),x.clearRect(0,0,t,i);var o=g.extent(),u=w.extent(),a=E==null?o:E;s.domain(a).range([i,0]),C=o.concat(u).every(isFinite);var f=n/e.step()&1?b:y;x.fillStyle=h[2];for(var l=0,c=t;l<c;++l){var d=s(g.valueAt(l)),v=s(w.valueAt(l));d<v&&x.fillRect(f(l),d,1,v-d)}x.fillStyle=h[0];for(l=0;l<c;++l){var d=s(g.valueAt(l)),v=s(w.valueAt(l));d>v&&x.fillRect(f(l),v,1,d-v)}x.fillStyle=h[3];for(l=0;l<c;++l){var d=s(g.valueAt(l)),v=s(w.valueAt(l));d<=v&&x.fillRect(f(l),d,1,p)}x.fillStyle=h[1];for(l=0;l<c;++l){var d=s(g.valueAt(l)),v=s(w.valueAt(l));d>v&&x.fillRect(f(l),d-p,1,p)}x.restore()}function L(e){e==null&&(e=t-1);var n=g.valueAt(e),r=w.valueAt(e),i=(n-r)/r;T.datum(n).text(isNaN(n)?null:l),N.datum(i).text(isNaN(i)?null:c).attr("class","value change "+(i>0?"positive":i<0?"negative":""))}function A(e,t){k(e,t),L(),C&&(g.on("change.comparison-"+m,r),w.on("change.comparison-"+m,r))}var v=this,m=++n,g=typeof o=="function"?o.call(v,f,d):o,w=typeof u=="function"?u.call(v,f,d):u,E=typeof a=="function"?a.call(v,f,d):a,S=d3.select(v),x=S.select("canvas"),T=S.select(".value.primary"),N=S.select(".value.change"),C;x.datum({id:m,primary:g,secondary:w}),x=x.node().getContext("2d"),g.on("change.comparison-"+m,A),w.on("change.comparison-"+m,A),e.on("change.comparison-"+m,k),e.on("focus.comparison-"+m,L)})}var e=this,t=e.size(),i=120,s=d3.scale.linear().interpolate(d3.interpolateRound),o=function(e){return e[0]},u=function(e){return e[1]},a=null,f=r,l=m,c=g,h=["#9ecae1","#225b84","#a1d99b","#22723a"],p=1.5;return d.remove=function(t){function n(t){t.primary.on("change.comparison-"+t.id,null),t.secondary.on("change.comparison-"+t.id,null),e.on("change.comparison-"+t.id,null),e.on("focus.comparison-"+t.id,null)}t.on("mousemove.comparison",null).on("mouseout.comparison",null),t.selectAll("canvas").each(n).remove(),t.selectAll(".title,.value").remove()},d.height=function(e){return arguments.length?(i=+e,d):i},d.primary=function(e){return arguments.length?(o=e,d):o},d.secondary=function(e){return arguments.length?(u=e,d):u},d.scale=function(e){return arguments.length?(s=e,d):s},d.extent=function(e){return arguments.length?(a=e,d):a},d.title=function(e){return arguments.length?(f=e,d):f},d.formatPrimary=function(e){return arguments.length?(l=e,d):l},d.formatChange=function(e){return arguments.length?(c=e,d):c},d.colors=function(e){return arguments.length?(h=e,d):h},d.strokeWidth=function(e){return arguments.length?(p=e,d):p},d};var m=d3.format(".2s"),g=d3.format("+.0%");s.axis=function(){function s(o){var u=++n,a,f=o.append("svg").datum({id:u}).attr("width",e.size()).attr("height",Math.max(28,-s.tickSize())).append("g").attr("transform","translate(0,"+(r.orient()==="top"?27:4)+")").call(r);e.on("change.axis-"+u,function(){f.call(r),a||(a=d3.select(f.node().appendChild(f.selectAll("text").node().cloneNode(!0))).style("display","none").text(null))}),e.on("focus.axis-"+u,function(e){if(a)if(e==null)a.style("display","none"),f.selectAll("text").style("fill-opacity",null);else{a.style("display",null).attr("x",e).text(i(t.invert(e)));var n=a.node().getComputedTextLength()+6;f.selectAll("text").style("fill-opacity",function(r){return Math.abs(t(r)-e)<n?0:1})}})}var e=this,t=e.scale,r=d3.svg.axis().scale(t),i=e.step()<6e4?w:e.step()<864e5?E:S;return s.remove=function(t){function n(t){e.on("change.axis-"+t.id,null),e.on("focus.axis-"+t.id,null)}t.selectAll("svg").each(n).remove()},d3.rebind(s,r,"orient","ticks","tickSubdivide","tickSize","tickPadding","tickFormat")};var w=d3.time.format("%I:%M:%S %p"),E=d3.time.format("%I:%M %p"),S=d3.time.format("%B %d");s.rule=function(){function t(t){var r=++n,i=t.append("div").datum({id:r}).attr("class","line").style("position","fixed").style("top",0).style("right",0).style("bottom",0).style("width","1px").style("pointer-events","none");e.on("focus.rule-"+r,function(e){i.style("display",e==null?"none":null).style("left",function(){return this.parentNode.getBoundingClientRect().left+e+"px"})})}var e=this;return t.remove=function(t){function n(t){e.on("focus.rule-"+t.id,null)}t.selectAll(".line").each(n).remove()},t}})(this);